osx: &osx
  os: osx
  language: generic

matrix:
  include:
    - stage: default
      <<: *osx
      osx_image: xcode9.4
      env: CONAN_APPLE_CLANG_VERSIONS=9.1
      if: env(splitByBuildTypes) = "false"
    - stage: default
      <<: *osx
      osx_image: xcode10.3
      env: CONAN_APPLE_CLANG_VERSIONS=10.0
      if: env(splitByBuildTypes) = "false"
    - stage: default
      <<: *osx
      osx_image: xcode11.3
      env: CONAN_APPLE_CLANG_VERSIONS=11.0
      if: env(splitByBuildTypes) = "false"
    # splitByBuildTypes == True
    - stage: default
      <<: *osx
      osx_image: xcode9.4
      env: CONAN_APPLE_CLANG_VERSIONS=9.1 CONAN_BUILD_TYPES=Debug
      if: env(splitByBuildTypes) = "true"
    - stage: default
      <<: *osx
      osx_image: xcode9.4
      env: CONAN_APPLE_CLANG_VERSIONS=9.1 CONAN_BUILD_TYPES=Release
      if: env(splitByBuildTypes) = "true"
    - stage: default
      <<: *osx
      osx_image: xcode10.3
      env: CONAN_APPLE_CLANG_VERSIONS=10.0 CONAN_BUILD_TYPES=Debug
      if: env(splitByBuildTypes) = "true"
    - stage: default
      <<: *osx
      osx_image: xcode10.3
      env: CONAN_APPLE_CLANG_VERSIONS=10.0 CONAN_BUILD_TYPES=Release
      if: env(splitByBuildTypes) = "true"
    - stage: default
      <<: *osx
      osx_image: xcode11.3
      env: CONAN_APPLE_CLANG_VERSIONS=11.0 CONAN_BUILD_TYPES=Debug
      if: env(splitByBuildTypes) = "true"
    - stage: default
      <<: *osx
      osx_image: xcode11.3
      env: CONAN_APPLE_CLANG_VERSIONS=11.0 CONAN_BUILD_TYPES=Release
      if: env(splitByBuildTypes) = "true"

install: |
  pip install --upgrade pip
  python --version
  pip --version
  if [[ "$(uname -s)" == 'Darwin' ]]; then
    rm -rf /usr/local/opt/pyenv;
    rm /usr/local/bin/pyenv;
    rm /usr/local/bin/pyenv-install;
    rm /usr/local/bin/pyenv-uninstall;
    ln -s /usr/local/opt/pyenv/libexec/pyenv /usr/local/bin/pyenv;
    unset PYENV_ROOT;
    curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash;
    export PATH="$HOME/.pyenv/bin:$PATH";
    eval "$(pyenv init -)";
    eval "$(pyenv virtualenv-init -)";
    pyenv --version;
    pyenv install 3.7.6;
    pyenv virtualenv 3.7.6 conan;
    pyenv rehash;
    pyenv activate conan;
    pip install cmake --upgrade;
  fi
  pip install bincrafters_package_tools
  conan user

script: |
  python build.py
